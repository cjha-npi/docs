<!-- HTML header for doxygen 1.14.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Main Project: Git Pre-Push Hook</title>
<link rel="icon" href="../../npi_icon.png" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<!-- 游릴 BEG ------------------------------------------------------------------------------------------------ -->
<!-- This script provides the default widths of side-nav and page-nav on very first load -->
<script>
(function () {
  var SIDE_NAV_KEY = 'doxygen_width';
  var SIDE_NAV_DEF_PX = 200;
  try {
    if (localStorage.getItem(SIDE_NAV_KEY) === null) {
      localStorage.setItem(SIDE_NAV_KEY, String(SIDE_NAV_DEF_PX));
    }
  } catch (e) {}
  var PAGE_NAV_KEY = 'doxygen_pagenav';
  var PAGE_NAV_DEF_PX = 150;
  try {
    if (localStorage.getItem(PAGE_NAV_KEY) === null) {
      localStorage.setItem(PAGE_NAV_KEY, String(PAGE_NAV_DEF_PX));
    }
  } catch (e) {}
})();
</script>
<!-- 游린 END ------------------------------------------------------------------------------------------------ -->
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxy-plus.css" rel="stylesheet" type="text/css"/>
<!-- 游릴 BEG ------------------------------------------------------------------------------------------------ -->
<!-- Doxy-Plus Stylesheet -->
<link href="../../doxy-plus.css" rel="stylesheet" type="text/css" />
<!-- Doxygen Awesome Theme - Dark Mode Toggle -->
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<!-- 游린 END ------------------------------------------------------------------------------------------------ -->
</head>
<body>
<!-- 游릴 BEG ------------------------------------------------------------------------------------------------ -->
  <!-- Doxy-Plus Root Navigation Container -->
  <div id="dp-root-pane" class="dp-nav-pane"></div>
  <div id="dp-root-pane-resizer" class="dp-nav-pane-resizer"></div>
  <!-- Doxy-Plus Leaf Navigation Container -->
  <div id="dp-leaf-pane" class="dp-nav-pane">
    <div id="dp-leaf-bg">
    <div id="dp-leaf-ul"></div>
    </div>
  </div>
  <div id="dp-leaf-pane-resizer" class="dp-nav-pane-resizer"></div>
<!-- 游린 END ------------------------------------------------------------------------------------------------ -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../npi_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Main Project<span id="projectnumber">&#160;3</span>
   </div>
   <div id="projectbrief">Main Project Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('df/d3d/md_pre-push-readme.html','../../',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Git Pre-Push Hook </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Introduction</h1>
<p>This document describes the <span class="tt">pre-push</span> hook script placed in the global Git hooks folder (configured via <span class="tt">core.hooksPath</span>). The hook mirrors a curated subset of repository files from a source workspace on drive <span class="tt">F:</span> to a target workspace on drive <span class="tt">E:</span>, under a branch-named subfolder.</p>
<dl class="section note"><dt>Note</dt><dd>The hook is non-blocking: it never prevents a <span class="tt">git push</span>. It always exits with code <span class="tt">0</span>.</dd></dl>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
What this hook does</h1>
<p>On every <span class="tt">git push</span> (including pushes initiated from Visual Studio), the hook:</p>
<ol type="1">
<li>Determines a source root:<ul>
<li>If inside a Git repository: the repository root (<span class="tt">git rev-parse --show-toplevel</span>).</li>
<li>Otherwise: the current directory.</li>
</ul>
</li>
<li>Computes a target root by:<ul>
<li>Replacing the drive prefix: <span class="tt">F:\...</span> -&gt; <span class="tt">E:\...</span> (case-insensitive).</li>
<li>Appending the current branch folder: <span class="tt">\&lt;branch&gt;\</span> (sanitized branch folder name by replacing certain invalid characters).</li>
</ul>
</li>
<li>Checks for preconditions/gates:<ul>
<li>Source is on <span class="tt">F:</span> and is not drive root.</li>
<li>Source root contains <span class="tt">*.sln</span> or <span class="tt">*.slnx</span>.</li>
</ul>
</li>
<li>If preconditions/gates are met, runs <span class="tt">robocopy</span>:<ul>
<li>Uses <span class="tt">robocopy</span> key <span class="tt">/PURGE</span> to remove extras in the destination within robocopy's scope.</li>
<li>Syncs only a defined set of file types from source to target.</li>
</ul>
</li>
<li>Logs everything to a file next to the hook script:<ul>
<li>Main log file is named <span class="tt">pre-push.log</span>.</li>
<li>Rotates to <span class="tt">pre-push.log.old</span> when the main log exceeds ~20 KB.</li>
</ul>
</li>
</ol>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Early Safety guard</h1>
<p>The script includes an early guard that exits immediately if <span class="tt">$0</span> contains no path separator.</p>
<p>Reason:</p><ul>
<li>The log location is derived from the directory of the script using <span class="tt">dirname "$0"</span>.</li>
<li>If the hook is invoked without a path (typically manual invocation via PATH), <span class="tt">dirname "$0"</span> becomes <span class="tt">.</span>, and the log could be written to an unintended folder.</li>
</ul>
<p>This guard keeps the "log next to this script" behavior reliable.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
Path mapping</h1>
<ul>
<li><b>Source:</b><ul>
<li>Repo root when inside a Git repo</li>
<li>Otherwise current directory</li>
</ul>
</li>
<li><b>Target:</b><ul>
<li>Base = Source with <span class="tt">F:\</span> replaced by <span class="tt">E:\</span> (case-insensitive)</li>
<li>Final = <span class="tt">Base\&lt;branch&gt;</span> (where <span class="tt">&lt;branch&gt;</span> is the sanitized branch folder name used by the script)</li>
</ul>
</li>
<li><b>Example:</b><ul>
<li>Source: <span class="tt">F:\sols\plot\</span></li>
<li>Branch: <span class="tt">main</span></li>
<li>Target: <span class="tt">E:\sols\plot\main\</span></li>
</ul>
</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Preconditions (Gates)</h1>
<p>The hook runs robocopy only if:</p>
<ol type="1">
<li>Source is on <span class="tt">F:</span> and is not drive root:<ul>
<li>Accepts <span class="tt">F:\something...</span></li>
<li>Rejects <span class="tt">F:\</span></li>
<li>Rejects anything not on <span class="tt">F:</span></li>
</ul>
</li>
<li>Source root contains at least one solution file in the root folder:<ul>
<li><span class="tt">*.sln</span> or <span class="tt">*.slnx</span> (case-insensitive) in the root directory only (not recursive)</li>
</ul>
</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>If a gate fails, the script logs the reason and exits successfully (push continues).</dd></dl>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Non-blocking behavior</h1>
<ul>
<li>The script is designed to never block a push.</li>
<li>Even if robocopy fails, the script:<ul>
<li>Logs the failure and exit code</li>
<li>Exits with <span class="tt">0</span></li>
</ul>
</li>
</ul>
<p>This is intentional so the hook acts as a best-effort exporter/backup step rather than a quality gate.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md13"></a>
Logging</h1>
<ol type="1">
<li>Log location: The log file is created next to the hook script (in the same folder as <span class="tt">pre-push</span>):<ul>
<li>Primary Log File: <span class="tt">pre-push.log</span></li>
<li>Backup Log File: <span class="tt">pre-push.log.old</span> (rotated)</li>
</ul>
</li>
<li>Log rotation: When <span class="tt">pre-push.log</span> exceeds 20480 bytes (~20 KB):<ul>
<li>Delete <span class="tt">pre-push.log.old</span> (if it exists)</li>
<li>Move <span class="tt">pre-push.log</span> -&gt; <span class="tt">pre-push.log.old</span></li>
<li>New output is written to a fresh <span class="tt">pre-push.log</span></li>
</ul>
</li>
<li>Log content: Each push creates a new log entry with:<ul>
<li>Timestamp (Windows time with milliseconds via PowerShell)</li>
<li>Source path (Windows form)</li>
<li>Branch name (raw)</li>
<li>Target path (Windows form, using the sanitized branch folder)</li>
<li>Gate decisions</li>
<li>Full robocopy output (stdout + stderr)</li>
<li>Robocopy summary outcome (success/failure with decoded meaning)</li>
<li>End timestamp footer (Windows time with milliseconds via PowerShell)</li>
</ul>
</li>
</ol>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md15"></a>
File selection rules</h1>
<ol type="1">
<li>Allowed list (copied file types) patterns:<ul>
<li>Source / C++ / Qt: <span class="tt">*.h</span>, <span class="tt">*.hpp</span>, <span class="tt">*.c</span>, <span class="tt">*.cpp</span>, <span class="tt">*.ui</span>, <span class="tt">*.qrc</span>, <span class="tt">*.qml</span>, <span class="tt">*.ts</span></li>
<li>Visual Studio: <span class="tt">*.sln</span>, <span class="tt">*.slnx</span>, <span class="tt">*.vcxproj</span>, <span class="tt">*.filters</span>, <span class="tt">*.user</span>, <span class="tt">*.props</span>, <span class="tt">*.targets</span></li>
<li>Config / data: <span class="tt">*.md</span>, <span class="tt">*.ini</span>, <span class="tt">*.json</span>, <span class="tt">*.cmake</span>, <span class="tt">*.pro</span>, <span class="tt">*.pri</span></li>
<li>Assets: <span class="tt">*.png</span>, <span class="tt">*.jpg</span>, <span class="tt">*.jpeg</span>, <span class="tt">*.bmp</span>, <span class="tt">*.svg</span>, <span class="tt">*.ico</span>, <span class="tt">*.ttf</span>, <span class="tt">*.otf</span>, <span class="tt">*.wav</span>, <span class="tt">*.mp3</span></li>
<li>Windows resources: <span class="tt">*.rc</span></li>
<li>Debug tooling: <span class="tt">*.natvis</span></li>
</ul>
</li>
<li><b>Blocked list</b> (at any depth and not just the root)<ul>
<li>Directories: Excluded via <span class="tt">/XD</span> key of <span class="tt">robocopy</span><ul>
<li><span class="tt">x64</span>, <span class="tt">x86</span>, <span class="tt">x32</span>, <span class="tt">win32</span></li>
<li><span class="tt">debug</span>, <span class="tt">release</span>, plus common variants like <span class="tt">x64_debug</span>, <span class="tt">x64_release</span>, etc.</li>
<li><span class="tt">build</span>, <span class="tt">__bin</span>, <span class="tt">__obj</span></li>
<li><span class="tt">.*</span> (any dot-prefixed directory)</li>
</ul>
</li>
<li>Files: Excluded via <span class="tt">/XD</span> key of <span class="tt">robocopy</span><ul>
<li><span class="tt">.*</span> (any dot-prefixed file)</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md17"></a>
Robocopy configuration</h1>
<p>The hook runs robocopy with the following key switches (high-level meaning):</p>
<ul>
<li><span class="tt">/S</span> : copy subdirectories (excluding empty directories)</li>
<li><span class="tt">/PURGE</span> : delete destination files/dirs that no longer exist in source (within robocopy scope)</li>
<li><span class="tt">/XJ</span> : exclude junction points</li>
<li><span class="tt">/R:2 /W:2</span> : retry twice, wait 2 seconds between retries</li>
<li><span class="tt">/COPY:DAT /DCOPY:DAT</span> : copy data, attributes, timestamps (files and directories)</li>
<li><span class="tt">/MAX:10485760</span> : do not copy files larger than 10 MB</li>
<li><span class="tt">/XD ...</span> : excluded directories</li>
<li><span class="tt">/XF ".*"</span> : excluded files</li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li><span class="tt">/PURGE</span> removes extras only within robocopy's scope.</li>
<li>Items excluded by <span class="tt">/XD</span>, <span class="tt">/XF</span>, or <span class="tt">/MAX</span> may remain in the destination if they already exist.</li>
</ul>
</dd></dl>
<p><b>Exit code handling:</b> Robocopy exit codes are bitmask-based. The script treats:</p><ul>
<li><span class="tt">0..7</span> as success (including "success with minor issues")</li>
<li><span class="tt">&gt;= 8</span> as failure</li>
<li>The hook logs a human-readable interpretation for codes <span class="tt">0..7</span>.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md19"></a>
Requirements / assumptions</h1>
<ul>
<li>Git for Windows (MSYS environment for hook execution)</li>
<li>Windows <span class="tt">robocopy.exe</span> available at <span class="tt">C:\Windows\System32\robocopy.exe</span> (the script calls it via this location)</li>
<li>Windows <span class="tt">powershell.exe</span> available for timestamps</li>
<li><span class="tt">pwd -W</span> available (Git for Windows/MSYS)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>If any of these are missing or restricted, the hook may skip or log errors but will not block pushes.</dd></dl>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md21"></a>
Setup</h1>
<ol type="1">
<li>Create a global hooks folder<ul>
<li>Example <span class="tt">C:\git-hooks\</span></li>
</ul>
</li>
<li>Place <span class="tt">pre-push</span> file with the code in this folder<ul>
<li>The name must be named exactly <span class="tt">pre-push</span> (no extension).</li>
<li>Should use LF line endings if possible.</li>
</ul>
</li>
<li>Configure Git to use the folder<ol type="a">
<li>Configure global hooks path (run in any shell): <div class="fragment"><div class="line">git config --global core.hooksPath &quot;C:/git-hooks&quot;</div>
</div><!-- fragment --></li>
<li>Mark the hook executable (run in Git Bash/MSYS): <div class="fragment"><div class="line">chmod +x /c/git-hooks/pre-push</div>
</div><!-- fragment --></li>
</ol>
</li>
<li>Verification<ol type="a">
<li>Check configured hooks path: <div class="fragment"><div class="line">git config --global --get core.hooksPath</div>
</div><!-- fragment --> It should return the configured hooks path (e.g. <span class="tt">C:/git-hooks</span>).</li>
<li>Trigger the hook (run a normal push in a repo on <span class="tt">F:</span>): <div class="fragment"><div class="line">git push</div>
</div><!-- fragment --> Then inspect <span class="tt">C:\git-hooks\pre-push.log</span></li>
</ol>
</li>
<li>Removal / disable<ol type="a">
<li>To disable global hooks: <div class="fragment"><div class="line">git config --global --unset core.hooksPath</div>
</div><!-- fragment --></li>
</ol>
</li>
</ol>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md23"></a>
Troubleshooting</h1>
<ul>
<li>Nothing gets copied and no logs are written<ul>
<li>Check if the hook is installed</li>
<li>May have exited due to <span class="tt">Early Safety Guard</span> i.e. if <span class="tt">$0</span> contains no path separator.</li>
</ul>
</li>
<li>Hook runs but robocopy does not execute:<ul>
<li>Gate 1 failed: source is not <span class="tt">F:\...</span> or source is <span class="tt">F:\</span></li>
<li>Gate 2 failed: no <span class="tt">*.sln</span> / <span class="tt">*.slnx</span> in the source root folder</li>
<li>Check <span class="tt">pre-push.log</span> for the exact gate result line</li>
</ul>
</li>
<li>Robocopy reports success but some files are missing:<ul>
<li>Extension not in allowlist</li>
<li>File larger than 10 MB (blocked by <span class="tt">/MAX</span>)</li>
<li>File/directory excluded by <span class="tt">/XD</span> or dot rules</li>
</ul>
</li>
<li>Robocopy reports failure (&gt;=8):<ul>
<li>Push still continues</li>
<li>Common causes: permission issues on <span class="tt">E:</span>, long path issues, locked files, missing/unavailable target drive</li>
<li>Check robocopy output in <span class="tt">pre-push.log</span></li>
</ul>
</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md25"></a>
Code</h1>
<dl class="section note"><dt>Note</dt><dd>This code is complete and can be copy pasted exactly to create the <span class="tt">pre-push</span> file.</dd></dl>
<div class="fragment"><div class="line">#!/bin/sh</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"># Shebang:</div>
<div class="line"># - `#!/bin/sh` selects the interpreter for this hook.</div>
<div class="line"># - In Git for Windows, hooks are executed via an sh-compatible shell.</div>
<div class="line"># - Keeping the shebang improves reliability when the push is triggered</div>
<div class="line">#   from non-shell tools (for example Visual Studio).</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"># Purpose:</div>
<div class="line">#   On `git push` (including pushes initiated from Visual Studio)</div>
<div class="line">#   copy a curated set of repository-related files from a source </div>
<div class="line">#   workspace on the F: drive to a target workspace on the E: drive.</div>
<div class="line">#</div>
<div class="line"># Path mapping:</div>
<div class="line"># - Source root is the Git repo root when available, otherwise the current dir.</div>
<div class="line"># - Target is derived by:</div>
<div class="line">#     1) replacing the drive prefix: F:\... -&gt; E:\...</div>
<div class="line">#     2) appending the current branch folder: &lt;branch&gt;\</div>
<div class="line"># - Example:</div>
<div class="line">#     Source repo root:  F:\sols\plot</div>
<div class="line">#     Branch:           main</div>
<div class="line">#     Source file:      F:\sols\plot\inc\npi\some.h</div>
<div class="line">#     Target file:      E:\sols\plot\main\inc\npi\some.h</div>
<div class="line">#</div>
<div class="line"># Non-blocking behavior:</div>
<div class="line"># - This hook never blocks a push: it always exits with code 0.</div>
<div class="line"># - Robocopy failures are logged but do not stop the push.</div>
<div class="line">#</div>
<div class="line"># Preconditions (gates):</div>
<div class="line"># - Runs ONLY if:</div>
<div class="line">#     1) Source is on F: and is not the drive root (not F:\&zwj;), AND</div>
<div class="line">#     2) Source root contains at least one *.sln or *.slnx in that root folder.</div>
<div class="line">#</div>
<div class="line"># Logging</div>
<div class="line"># - Logs to: &lt;hooksPath&gt;\pre-push.log (next to this script).</div>
<div class="line"># - Log rotation: if log exceeds 20 KB, it is rotated to pre-push.log.old.</div>
<div class="line">#</div>
<div class="line"># Notes:</div>
<div class="line"># - The file set is typically source and project files such as:</div>
<div class="line">#   *.h, *.hpp, *.c, *.cpp, *.sln, *.slnx, *.vcxproj*, *.qrc, *.png, etc.</div>
<div class="line"># - The actual copy is performed using ROBOCOPY</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"># Installation (suggested):</div>
<div class="line"># 1) Create folder:</div>
<div class="line">#    C:\git-hooks\</div>
<div class="line">#</div>
<div class="line"># 2) Place files in that folder:</div>
<div class="line">#    - pre-push              (this file; no extension; LF line endings)</div>
<div class="line">#</div>
<div class="line"># 3) Configure Git to use the global hooks folder (any shell):</div>
<div class="line">#    git config --global core.hooksPath &quot;C:/git-hooks&quot;</div>
<div class="line">#</div>
<div class="line"># 4) Mark the hook executable (Git Bash/MSYS):</div>
<div class="line">#    chmod +x /c/git-hooks/pre-push</div>
<div class="line">#</div>
<div class="line"># Verification:</div>
<div class="line"># - Check configured hooks path:</div>
<div class="line">#   git config --global --get core.hooksPath</div>
<div class="line">#</div>
<div class="line"># Removal:</div>
<div class="line"># - Disable global hooks path:</div>
<div class="line">#   git config --global --unset core.hooksPath</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"># Path conventions:</div>
<div class="line"># - For shell operations and redirection in `sh`, use MSYS/Unix-style</div>
<div class="line">#   paths (e.g. /f/Eval/SolA or /c/git-hooks).</div>
<div class="line"># - For Windows tools (PowerShell, robocopy), use Windows drive-letter</div>
<div class="line">#   paths (e.g. F:\Eval\SolA). Some tools accept forward slashes, but</div>
<div class="line">#   backslashes are the safest/canonical form.</div>
<div class="line">#</div>
<div class="line"># Naming:</div>
<div class="line"># - `*_UNIX`: MSYS/Unix-style paths (e.g. /f/Eval/SolA)</div>
<div class="line"># - `*_WIN_ANY_SLASHES`: Windows drive-letter path where slash style is</div>
<div class="line">#   not guaranteed (e.g. F:/Eval/SolA or F:\Eval\SolA)</div>
<div class="line"># - `*_WIN`: Windows drive-letter path normalized to backslashes</div>
<div class="line">#   (e.g. F:\Eval\SolA)</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># ---------- Hooks folder and derived file paths -------------</div>
<div class="line"># - Resolve the directory (HOOK_UNIX) that contains this hook script (`$0`).</div>
<div class="line"># - Get LOG_UNIX and OLD_LOG_UNIX in HOOK_UNIX folder for log rotation/appending.</div>
<div class="line"> </div>
<div class="line">case &quot;$0&quot; in</div>
<div class="line">  */*|*\\*) ;;  # OK: invoked with a path component</div>
<div class="line">  *)</div>
<div class="line">    # Unexpected (typically manual invocation via PATH). Skip to avoid</div>
<div class="line">    # writing logs in the wrong place and to avoid /PURGE risk.</div>
<div class="line">    exit 0</div>
<div class="line">    ;;</div>
<div class="line">esac</div>
<div class="line"> </div>
<div class="line"># Hook directory (MSYS/Unix-style path, suitable for sh file operations)</div>
<div class="line">HOOK_UNIX=&quot;$(cd &quot;$(dirname &quot;$0&quot;)&quot; &amp;&amp; pwd)&quot;</div>
<div class="line"> </div>
<div class="line"># Current log file path (MSYS/Unix-style for sh redirection)</div>
<div class="line">LOG_UNIX=&quot;$HOOK_UNIX/pre-push.log&quot;</div>
<div class="line"> </div>
<div class="line"># Rotated/old log file path (MSYS/Unix-style for sh file operations)</div>
<div class="line">OLD_LOG_UNIX=&quot;$HOOK_UNIX/pre-push.log.old&quot;</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># --------------------- Log rotation (~20 KB) ----------------</div>
<div class="line"># Goal:</div>
<div class="line"># - Prevent the hook log from growing without bound.</div>
<div class="line">#</div>
<div class="line"># Behavior:</div>
<div class="line"># - If `pre-push.log` exists and exceeds 20 KB (20480 bytes):</div>
<div class="line">#     1) delete `pre-push.log.old` if present</div>
<div class="line">#     2) move `pre-push.log` -&gt; `pre-push.log.old`</div>
<div class="line"># - Subsequent writes will create/append to a fresh `pre-push.log`.</div>
<div class="line"> </div>
<div class="line">if [ -f &quot;$LOG_UNIX&quot; ]; then</div>
<div class="line">  size_bytes=$(wc -c &lt;&quot;$LOG_UNIX&quot; 2&gt;/dev/null | tr -d &#39;[:space:]&#39;)</div>
<div class="line">  if [ -n &quot;$size_bytes&quot; ] &amp;&amp; [ &quot;$size_bytes&quot; -gt 20480 ]; then</div>
<div class="line">    [ -f &quot;$OLD_LOG_UNIX&quot; ] &amp;&amp; rm -f &quot;$OLD_LOG_UNIX&quot;</div>
<div class="line">    mv -f &quot;$LOG_UNIX&quot; &quot;$OLD_LOG_UNIX&quot;</div>
<div class="line">  fi</div>
<div class="line">fi</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># --------------- Done and Exit Helper -----------------------</div>
<div class="line"># Goal:</div>
<div class="line"># - Provide a single, consistent way to finish the hook:</div>
<div class="line">#     * write a timestamped footer to the log</div>
<div class="line">#     * exit successfully (do not block the push)</div>
<div class="line">#</div>
<div class="line"># Implementation details:</div>
<div class="line"># - Uses PowerShell `Get-Date` to get a reliable Windows timestamp with</div>
<div class="line">#   milliseconds (yyyy-MM-dd HH:mm:ss.fff).</div>
<div class="line"># - `tr -d &#39;\r&#39;` removes the trailing CR from `powershell.exe` output.</div>
<div class="line">#</div>
<div class="line"># Notes:</div>
<div class="line"># - This hook is intentionally non-blocking: it always exits with code 0.</div>
<div class="line"> </div>
<div class="line">done_and_exit_0() {</div>
<div class="line">  END_DT=&quot;$(powershell.exe -NoProfile -Command &quot;Get-Date -Format &#39;yyyy-MM-dd HH:mm:ss.fff&#39;&quot; 2&gt;/dev/null | tr -d &#39;\r&#39;)&quot;</div>
<div class="line">  echo &quot;&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line">  echo &quot;==================== Pre-Push End: $END_DT ====================&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line">  exit 0</div>
<div class="line">}</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># ---------- Ensure we operate from source/repo root ----------</div>
<div class="line"># - If inside a Git repo, use the repo root even when the push is invoked</div>
<div class="line">#   from a subfolder.</div>
<div class="line"># - If not inside a repo, fall back to the current directory.</div>
<div class="line"># - `pwd -W` returns a Windows path (often with forward slashes, e.g. F:/...),</div>
<div class="line">#   so we normalize it to backslashes for consistent logging and Windows-tool</div>
<div class="line">#   (Powershell, robocopy) arguments.</div>
<div class="line"> </div>
<div class="line"># Source/repo root (or current directory if not in a Git repo)</div>
<div class="line">SOURCE_UNIX=&quot;$(git rev-parse --show-toplevel 2&gt;/dev/null || pwd)&quot;</div>
<div class="line"> </div>
<div class="line"># cd to that directory (must succeed; otherwise log and exit)</div>
<div class="line">if ! cd &quot;$SOURCE_UNIX&quot; 2&gt;/dev/null; then</div>
<div class="line">  CUR_UNIX=&quot;$(pwd 2&gt;/dev/null || printf &#39;&#39;)&quot;</div>
<div class="line">  CUR_WIN_ANY_SLASHES=&quot;$(pwd -W 2&gt;/dev/null || printf &#39;&#39;)&quot;</div>
<div class="line">  CUR_WIN=&quot;$(printf &#39;%s&#39; &quot;$CUR_WIN_ANY_SLASHES&quot; | sed &#39;s,/,\\,g&#39;)&quot;</div>
<div class="line"> </div>
<div class="line">  BEG_DT=&quot;$(powershell.exe -NoProfile -Command &quot;Get-Date -Format &#39;yyyy-MM-dd HH:mm:ss.fff&#39;&quot; 2&gt;/dev/null | tr -d &#39;\r&#39;)&quot;</div>
<div class="line">  [ -s &quot;$LOG_UNIX&quot; ] &amp;&amp; echo &quot;&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line">  {</div>
<div class="line">    echo &quot;=================== Pre-Push Start: $BEG_DT ===================&quot;</div>
<div class="line">    echo &quot;&quot;</div>
<div class="line">    echo &quot;ERROR: Failed to cd to repo root/source. Exiting...&quot;</div>
<div class="line">    echo &quot;SOURCE_UNIX = $SOURCE_UNIX&quot;</div>
<div class="line">    echo &quot;CUR_UNIX    = $CUR_UNIX&quot;</div>
<div class="line">    echo &quot;CUR_WIN     = $CUR_WIN&quot;</div>
<div class="line">  } &gt;&gt; &quot;$LOG_UNIX&quot; 2&gt;&amp;1</div>
<div class="line"> </div>
<div class="line">  done_and_exit_0</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"># Current directory as Windows path (slash style not guaranteed)</div>
<div class="line">SOURCE_WIN_ANY_SLASHES=&quot;$(pwd -W 2&gt;/dev/null || printf &#39;&#39;)&quot;</div>
<div class="line"> </div>
<div class="line"># Normalize to backslashes</div>
<div class="line">SOURCE_WIN=&quot;$(printf &#39;%s&#39; &quot;$SOURCE_WIN_ANY_SLASHES&quot; | sed &#39;s,/,\\,g&#39;)&quot;</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># ---------- Branch name and derived target path -------------</div>
<div class="line"># - Determine the current branch name for the backup destination.</div>
<div class="line"># - Normalize/sanitize the branch so it is safe to use as a folder name.</div>
<div class="line"># - Derive the target base path by mapping the source drive letter:</div>
<div class="line">#     F:\...  -&gt; E:\...</div>
<div class="line"># - Append the branch folder to form the final target root:</div>
<div class="line">#     E:&lt;source-relative-path&gt;&lt;branch&gt;\</div>
<div class="line"> </div>
<div class="line"># Current branch name (may be empty if not a Git repo)</div>
<div class="line">BRANCH=&quot;$(git rev-parse --abbrev-ref HEAD 2&gt;/dev/null || printf &#39;&#39;)&quot;</div>
<div class="line"> </div>
<div class="line"># Fallback if branch cannot be determined</div>
<div class="line">[ -n &quot;$BRANCH&quot; ] || BRANCH=&quot;UNKNOWN&quot;</div>
<div class="line"> </div>
<div class="line"># Sanitize branch for use as a Windows folder name</div>
<div class="line"># - Replace path separators with &#39;_&#39;</div>
<div class="line"># - Replace invalid Windows filename characters with &#39;_&#39;</div>
<div class="line">BRANCH_DIR=&quot;$(printf &#39;%s&#39; &quot;$BRANCH&quot; | sed &#39;s,[/\\],_,g; s,[:*?&quot;&lt;&gt;|],_,g&#39;)&quot;</div>
<div class="line"> </div>
<div class="line"># Map source drive F:\... to target drive E:\... (case-insensitive)</div>
<div class="line">TARGET_BASE_WIN=&quot;$(printf &#39;%s&#39; &quot;$SOURCE_WIN&quot; | sed &#39;s,^[Ff]:\\,E:\\,&#39;)&quot;</div>
<div class="line"> </div>
<div class="line"># Final target root: &lt;E:\...&gt;&lt;branch&gt;</div>
<div class="line">TARGET_WIN=&quot;$TARGET_BASE_WIN\\$BRANCH_DIR&quot;</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># --------------- Start a new log entry ----------------------</div>
<div class="line"># Goal:</div>
<div class="line"># - Append a clearly separated entry to the hook log for each `git push`.</div>
<div class="line"># - Include a high-resolution timestamp (milliseconds) and key context</div>
<div class="line">#   (source, branch, target) to simplify troubleshooting.</div>
<div class="line">#</div>
<div class="line"># Implementation details:</div>
<div class="line"># - Uses PowerShell `Get-Date` for a consistent Windows timestamp with</div>
<div class="line">#   milliseconds (yyyy-MM-dd HH:mm:ss.fff).</div>
<div class="line"># - Adds a blank line between entries if the log already has content.</div>
<div class="line"># - Redirects both stdout and stderr from the block into the same log file.</div>
<div class="line"> </div>
<div class="line"># Timestamp with milliseconds (PowerShell is reliable on Windows)</div>
<div class="line">BEG_DT=&quot;$(powershell.exe -NoProfile -Command &quot;Get-Date -Format &#39;yyyy-MM-dd HH:mm:ss.fff&#39;&quot; 2&gt;/dev/null | tr -d &#39;\r&#39;)&quot;</div>
<div class="line"> </div>
<div class="line"># Separate entries with a blank line if the log is non-empty</div>
<div class="line">[ -s &quot;$LOG_UNIX&quot; ] &amp;&amp; echo &quot;&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line"> </div>
<div class="line"># Write entry header and context (append; capture stderr as well)</div>
<div class="line">{</div>
<div class="line">  echo &quot;=================== Pre-Push Start: $BEG_DT ===================&quot;</div>
<div class="line">  echo &quot;&quot;</div>
<div class="line">  echo &quot;SOURCE = $SOURCE_WIN&quot;</div>
<div class="line">  echo &quot;BRANCH = $BRANCH&quot;</div>
<div class="line">  echo &quot;TARGET = $TARGET_WIN&quot;</div>
<div class="line">  echo &quot;&quot;</div>
<div class="line">  echo &quot;Checking Conditions...&quot;</div>
<div class="line">} &gt;&gt; &quot;$LOG_UNIX&quot; 2&gt;&amp;1</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># ---------- Gates: Preconditions for exporter to run ---------</div>
<div class="line"># Goal:</div>
<div class="line"># - Run the exporter only for eligible sources to avoid unnecessary work</div>
<div class="line">#   (and to keep the target tree clean).</div>
<div class="line">#</div>
<div class="line"># Gates:</div>
<div class="line"># 1) Source must be on the F: drive (case-insensitive) AND not be F:\ (drive root).</div>
<div class="line"># 2) Source root must contain at least one solution file (*.sln or *.slnx).</div>
<div class="line">#</div>
<div class="line"># Notes:</div>
<div class="line"># - On any gate failure, log the reason and exit successfully (non-blocking).</div>
<div class="line"> </div>
<div class="line"># Gate 1: Require F:\ plus at least one more character (rejects F:\ itself).</div>
<div class="line">case &quot;$SOURCE_WIN&quot; in</div>
<div class="line">  [Ff]:\\?*) ;;  # OK: F:\ plus at least one more character (not F:\&zwj;)</div>
<div class="line">  *)</div>
<div class="line">    echo &quot;1. Source on F: and not drive root: NO (skipping)&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line">    done_and_exit_0</div>
<div class="line">    ;;</div>
<div class="line">esac</div>
<div class="line">echo &quot;1. Source on F: and not drive root: YES&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line"> </div>
<div class="line"># Gate 2: Require at least one .sln/.slnx in the source/root folder.</div>
<div class="line">SOLUTION_FILE=&quot;&quot;</div>
<div class="line">for f in ./*.sln ./*.SLN ./*.slnx ./*.SLNX; do</div>
<div class="line">  [ -f &quot;$f&quot; ] || continue</div>
<div class="line">  SOLUTION_FILE=&quot;$f&quot;</div>
<div class="line">  break</div>
<div class="line">done</div>
<div class="line"> </div>
<div class="line">if [ -z &quot;$SOLUTION_FILE&quot; ]; then</div>
<div class="line">  echo &quot;2. Root contains .sln/.slnx: NO (skipping)&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line">  done_and_exit_0</div>
<div class="line">fi</div>
<div class="line">echo &quot;2. Root contains .sln/.slnx: YES ($SOLUTION_FILE)&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line"> </div>
<div class="line">echo &quot;Conditions met. Running robocopy...&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># ----------------- Running robocopy -------------------------</div>
<div class="line"># Goal:</div>
<div class="line"># - Sync a filtered subset of the repository from SOURCE -&gt; TARGET.</div>
<div class="line"># - Runs in Git for Windows pre-push (sh/MSYS).</div>
<div class="line">#</div>
<div class="line"># What is copied:</div>
<div class="line"># - Only files that match the explicit allowlist patterns below (extensions).</div>
<div class="line">#</div>
<div class="line"># What is excluded:</div>
<div class="line"># - Build/output directories (x64/Debug/Release/etc.) anywhere in the tree.</div>
<div class="line"># - Any dot-prefixed file or directory (&quot; .* &quot;).</div>
<div class="line">#</div>
<div class="line"># Sync semantics:</div>
<div class="line"># - /PURGE deletes destination items that are not present in source *within robocopy&#39;s scope*.</div>
<div class="line">#   Items excluded by /XD, /XF, or /MAX may remain in TARGET if they already exist there.</div>
<div class="line">#</div>
<div class="line"># Git for Windows specifics:</div>
<div class="line"># - set -f disables shell globbing so wildcard patterns are passed to robocopy as-is.</div>
<div class="line"># - MSYS2_ARG_CONV_EXCL/MSYS_NO_PATHCONV prevent MSYS from rewriting switches like /S into S:/.</div>
<div class="line">#</div>
<div class="line"># Robocopy exit codes (bitmask):</div>
<div class="line"># - 0..7  =&gt; success (e.g. 1=copied files, 2=extras removed, 3=both)</div>
<div class="line"># - &gt;=8   =&gt; failure</div>
<div class="line">#</div>
<div class="line">set -f</div>
<div class="line">MSYS2_ARG_CONV_EXCL=&#39;*&#39; MSYS_NO_PATHCONV=1 \</div>
<div class="line">&quot;/c/Windows/System32/robocopy.exe&quot; &quot;$SOURCE_WIN&quot; &quot;$TARGET_WIN&quot; \</div>
<div class="line">  &quot;*.h&quot; &quot;*.hpp&quot; &quot;*.c&quot; &quot;*.cpp&quot; &quot;*.ui&quot; &quot;*.qrc&quot; &quot;*.sln&quot; &quot;*.slnx&quot; \</div>
<div class="line">  &quot;*.vcxproj&quot; &quot;*.filters&quot; &quot;*.user&quot; &quot;*.props&quot; &quot;*.targets&quot; \</div>
<div class="line">  &quot;*.md&quot; &quot;*.ini&quot; &quot;*.json&quot; &quot;*.qml&quot; &quot;*.ts&quot; &quot;*.cmake&quot; &quot;*.pro&quot; &quot;*.pri&quot; \</div>
<div class="line">  &quot;*.png&quot; &quot;*.jpg&quot; &quot;*.jpeg&quot; &quot;*.bmp&quot; &quot;*.svg&quot; &quot;*.ico&quot; &quot;*.ttf&quot; &quot;*.otf&quot; \</div>
<div class="line">  &quot;*.wav&quot; &quot;*.mp3&quot; &quot;*.rc&quot; &quot;*.natvis&quot; \</div>
<div class="line">  /S /PURGE /XJ /R:2 /W:2 /COPY:DAT /DCOPY:DAT \</div>
<div class="line">  /MAX:10485760 \</div>
<div class="line">  /XD &quot;x64&quot; &quot;x86&quot; &quot;x32&quot; &quot;win32&quot; &quot;debug&quot; &quot;release&quot; &quot;x64_debug&quot; &quot;x64_release&quot; \</div>
<div class="line">      &quot;x32_debug&quot; &quot;x32_release&quot; &quot;x86_debug&quot; &quot;x86_release&quot; &quot;build&quot; &quot;__bin&quot; &quot;__obj&quot; &quot;.*&quot; \</div>
<div class="line">  /XF &quot;.*&quot; \</div>
<div class="line">  &gt;&gt; &quot;$LOG_UNIX&quot; 2&gt;&amp;1</div>
<div class="line">rc=$?</div>
<div class="line">set +f</div>
<div class="line"> </div>
<div class="line"># Robocopy exit codes (bitmask). 0..7 are success. Common meanings:</div>
<div class="line">#   0 = No changes (no files copied, no deletions).</div>
<div class="line">#   1 = Files copied (at least one file copied).</div>
<div class="line">#   2 = Extra files/dirs were present in DEST and were removed (common with /PURGE).</div>
<div class="line">#   3 = Files copied + extras removed (1 + 2).</div>
<div class="line">#   4 = Mismatched files detected (e.g. some files could not be copied and will be retried).</div>
<div class="line">#   5 = Files copied + mismatches (1 + 4).</div>
<div class="line">#   6 = Extras removed + mismatches (2 + 4).</div>
<div class="line">#   7 = Files copied + extras removed + mismatches (1 + 2 + 4).</div>
<div class="line">#   &gt;= 8 = Failure (one or more errors).</div>
<div class="line">#</div>
<div class="line">if [ &quot;$rc&quot; -lt 8 ]; then</div>
<div class="line">  case &quot;$rc&quot; in</div>
<div class="line">    0) msg=&quot;0: OK - No changes.&quot; ;;</div>
<div class="line">    1) msg=&quot;1: OK - Copied files.&quot; ;;</div>
<div class="line">    2) msg=&quot;2: OK - Removed extras in destination (/PURGE).&quot; ;;</div>
<div class="line">    3) msg=&quot;3: OK - Copied files and removed extras.&quot; ;;</div>
<div class="line">    4) msg=&quot;4: OK (with issues) - Mismatches detected.&quot; ;;</div>
<div class="line">    5) msg=&quot;5: OK (with issues) - Copied files and mismatches detected.&quot; ;;</div>
<div class="line">    6) msg=&quot;6: OK (with issues) - Removed extras and mismatches detected.&quot; ;;</div>
<div class="line">    7) msg=&quot;7: OK (with issues) - Copied files, removed extras, and mismatches detected.&quot; ;;</div>
<div class="line">    *) msg=&quot;$rc: OK - (unexpected code &lt; 8).&quot; ;;</div>
<div class="line">  esac</div>
<div class="line">  echo &quot;Robocopy success. $msg&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line">else</div>
<div class="line">  echo &quot;Robocopy failure (&gt;=8). Exit code = $rc. Push will continue (non-blocking).&quot; &gt;&gt; &quot;$LOG_UNIX&quot;</div>
<div class="line">fi</div>
<div class="line"># ------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"># -------------- Write footer and exit -----------------------</div>
<div class="line">done_and_exit_0</div>
<div class="line"># ------------------------------------------------------------</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.14.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for Main Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
<!-- 游릴 BEG ------------------------------------------------------------------------------------------------ -->
<!-- store.js with all plugins include expire and namespace plugins -->
<script type="text/javascript" src="../../store.everything.min.js"></script>
<!-- Storing Generation DateTime for use in doxy-plus.js -->
<script> window.DOXY_PLUS_DATE_TIME = 'Thu Feb 26 2026 22:33:37'; </script>
<!-- Doxy-Plus Custom JavaScript File -->
<script type="text/javascript" src="../../doxy-plus.js"></script>
<!-- 游린 END ------------------------------------------------------------------------------------------------ -->
</body>
</html>
